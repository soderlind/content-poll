(()=>{var t;t=function(){document.querySelectorAll(".content-poll").forEach(t=>{const e=t.getAttribute("data-poll-id"),o=t.getAttribute("data-block-id");let n=parseInt(t.getAttribute("data-post-id"),10);if(!n&&window.wp?.data?.select){const t=window.wp.data.select("core/editor");t&&"function"==typeof t.getCurrentPostId&&(n=t.getCurrentPostId()||0)}const l=t.getAttribute("data-nonce"),s="true"===t.getAttribute("data-debug"),r=t.querySelector(".content-poll__message"),c={thankYou:t.getAttribute("data-i18n-thank-you")||"Thank you for voting!",networkError:t.getAttribute("data-i18n-network-error")||"Network error. Please try again."};function a(e){const o=t.querySelector(`.content-poll__option[data-index="${e}"] .content-poll__label`);return o?o.textContent:`Option ${e+1}`}function i(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function d(e){if(!e||void 0===e.totalVotes)return;if(!s&&0===e.totalVotes)return;const o=t.querySelectorAll(".content-poll__option").length;let n="";const l=e.counts||{},r=e.percentages||{};for(let t=0;t<o;t++){const e=l[t]||0,o=r[t]||0,s=a(t);n+='<div class="content-poll__result-item"><div class="content-poll__result-label"><span><strong>'+String.fromCharCode(65+t)+".</strong> "+i(s)+'</span><span class="content-poll__result-count" aria-label="'+o+"% of votes ("+e+')">'+o+'%</span></div><div class="content-poll__result-bar"><div class="content-poll__result-fill" style="width: '+o+'%"></div></div></div>'}const c=e.totalVotes||0;n+='<div class="content-poll__results-total">'+c+" vote"+(1!==c?"s":"")+"</div>";let d=t.querySelector(".content-poll__results");d||(d=document.createElement("div"),d.className="content-poll__results",d.setAttribute("role","status"),d.setAttribute("aria-live","polite"),t.appendChild(d)),d.innerHTML=n}const p=e||o;fetch(`${window.location.origin}/wp-json/content-poll/v1/block/${p}/results`).then(t=>t.json()).then(e=>{if(e&&e.totalVotes&&e.totalVotes>0){if(r.textContent=c.thankYou,void 0!==e.userVote){const o=t.querySelector(`.content-poll__option[data-index="${e.userVote}"]`);o&&o.classList.add("content-poll__option--selected"),t.classList.add("content-poll--results-only")}t.querySelectorAll(".content-poll__option").forEach(t=>t.classList.add("content-poll__option--disabled")),t.classList.add("content-poll--results-only"),d(e)}}).catch(()=>{}),t.querySelectorAll(".content-poll__option").forEach(s=>{s.addEventListener("click",()=>{if(s.classList.contains("content-poll__option--disabled"))return;const a=parseInt(s.getAttribute("data-index"),10);r.textContent="";const i=e||o;fetch(`${window.location.origin}/wp-json/content-poll/v1/block/${i}/vote`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":l},body:JSON.stringify({optionIndex:a,postId:n})}).then(t=>t.json()).then(n=>{if(n.error)return void(r.textContent=n.message||c.networkError);r.textContent=c.thankYou,s.classList.add("content-poll__option--selected"),t.querySelectorAll(".content-poll__option").forEach(t=>t.classList.add("content-poll__option--disabled")),t.classList.add("content-poll--results-only");const l=e||o;fetch(`${window.location.origin}/wp-json/content-poll/v1/block/${l}/results`).then(t=>t.json()).then(t=>{d(t)}).catch(()=>{})}).catch(()=>{r.textContent=c.networkError})}),s.addEventListener("keydown",t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),s.click())})});const u=t.querySelector(".content-poll__reset-btn");u&&u.addEventListener("click",()=>{const n=e||o;fetch(`${window.location.origin}/wp-json/content-poll/v1/block/${n}/reset`,{method:"POST",headers:{"Content-Type":"application/json"}}).then(t=>t.json()).then(e=>{if(e.success){t.querySelectorAll(".content-poll__option").forEach(t=>{t.classList.remove("content-poll__option--disabled"),t.classList.remove("content-poll__option--selected")}),r.textContent="",t.classList.remove("content-poll--results-only");const e=t.querySelector(".content-poll__results");e&&e.remove()}}).catch(()=>{r.textContent="Failed to reset. Please refresh the page."})})})},"loading"!==document.readyState?t():document.addEventListener("DOMContentLoaded",t)})();