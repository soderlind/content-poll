(()=>{var t;t=function(){document.querySelectorAll(".content-vote").forEach(t=>{const e=t.getAttribute("data-block-id"),o=t.getAttribute("data-nonce"),n="true"===t.getAttribute("data-debug"),s=t.querySelector(".content-vote__message"),c={thankYou:t.getAttribute("data-i18n-thank-you")||"Thank you for voting!",networkError:t.getAttribute("data-i18n-network-error")||"Network error. Please try again."};function r(e){const o=t.querySelector(`.content-vote__option[data-index="${e}"] .content-vote__label`);return o?o.textContent:`Option ${e+1}`}function l(e){if(n&&console.log("displayResults called with:",e),!e||void 0===e.totalVotes)return void(n&&console.log("No results or totalVotes undefined"));if(!n&&0===e.totalVotes)return void(n&&console.log("Not debug mode and no votes"));const o=t.querySelectorAll(".content-vote__option").length;let s="";const c=e.counts||{},l=e.percentages||{};for(let t=0;t<o;t++){const e=c[t]||0,o=l[t]||0,n=r(t);s+='<div class="content-vote__result-item"><div class="content-vote__result-percentage">'+o+'%</div><div class="content-vote__result-label"><span><strong>'+String.fromCharCode(65+t)+".</strong> "+n+'</span><span class="content-vote__result-count">'+e+" vote"+(1!==e?"s":"")+'</span></div><div class="content-vote__result-bar"><div class="content-vote__result-fill" style="width: '+o+'%"></div></div></div>'}n&&console.log("resultsHTML:",s);let i=t.querySelector(".content-vote__results");i||(i=document.createElement("div"),i.className="content-vote__results",i.setAttribute("role","status"),i.setAttribute("aria-live","polite"),t.appendChild(i)),i.innerHTML=s,n&&console.log("Results displayed")}fetch(window.location.origin+"/wp-json/content-vote/v1/block/"+e+"/results").then(t=>t.json()).then(e=>{if(e&&e.totalVotes&&e.totalVotes>0){if(s.textContent=c.thankYou,void 0!==e.userVote){const o=t.querySelector(`.content-vote__option[data-index="${e.userVote}"]`);o&&o.classList.add("content-vote__option--selected")}t.querySelectorAll(".content-vote__option").forEach(t=>t.classList.add("content-vote__option--disabled")),l(e)}}).catch(()=>{}),t.querySelectorAll(".content-vote__option").forEach(r=>{r.addEventListener("click",()=>{if(r.classList.contains("content-vote__option--disabled"))return;const i=parseInt(r.getAttribute("data-index"),10);s.textContent="",fetch(window.location.origin+"/wp-json/content-vote/v1/block/"+e+"/vote",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":o},body:JSON.stringify({optionIndex:i,postId:window.contentVotePostId||0})}).then(t=>t.json()).then(o=>{o.error?s.textContent=o.message||c.networkError:(s.textContent=c.thankYou,r.classList.add("content-vote__option--selected"),t.querySelectorAll(".content-vote__option").forEach(t=>t.classList.add("content-vote__option--disabled")),fetch(window.location.origin+"/wp-json/content-vote/v1/block/"+e+"/results").then(t=>t.json()).then(t=>{n&&console.log("Results fetched:",t),l(t)}).catch(t=>{n&&console.error("Failed to fetch results:",t)}))}).catch(()=>{s.textContent=c.networkError})}),r.addEventListener("keydown",t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),r.click())})});const i=t.querySelector(".content-vote__reset-btn");i&&i.addEventListener("click",()=>{fetch(window.location.origin+"/wp-json/content-vote/v1/block/"+e+"/reset",{method:"POST",headers:{"Content-Type":"application/json"}}).then(t=>t.json()).then(e=>{if(e.success){t.querySelectorAll(".content-vote__option").forEach(t=>{t.classList.remove("content-vote__option--disabled"),t.classList.remove("content-vote__option--selected")}),s.textContent="";const e=t.querySelector(".content-vote__results");e&&e.remove()}}).catch(()=>{s.textContent="Failed to reset. Please refresh the page."})})})},"loading"!==document.readyState?t():document.addEventListener("DOMContentLoaded",t)})();