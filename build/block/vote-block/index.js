(()=>{"use strict";var t,e={113:()=>{const t=window.React,e=window.wp.blocks,o=window.wp.element,n=window.wp.components,r=window.wp.blockEditor,i=window.wp.i18n,s=t=>Math.min(6,Math.max(2,t)),a=(t,e,o="Option")=>{const n=s(e);let r=[...t];if(r.length<n)for(let t=r.length;t<n;t++)r.push(o);else r.length>n&&(r=r.slice(0,n));return r};(0,e.registerBlockType)("content-vote/vote-block",{edit:function(e){const{attributes:c,setAttributes:l}=e,{question:p,options:u,blockId:d}=c,[v,w]=(0,o.useState)(u.length),[m,x]=(0,o.useState)(!1),[h,g]=(0,o.useState)(!1),[f,b]=(0,o.useState)(""),_=(0,r.useBlockProps)({className:"content-vote-editor"});return d||l({blockId:window?.crypto&&"function"==typeof window.crypto.randomUUID?window.crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})}),(0,o.useEffect)(()=>{d&&fetch(window.location.origin+"/wp-json/content-vote/v1/block/"+d+"/results").then(t=>t.json()).then(t=>{t&&t.totalVotes&&t.totalVotes>0&&x(!0)}).catch(()=>{})},[d]),(0,t.createElement)(t.Fragment,null,(0,t.createElement)(r.InspectorControls,null,(0,t.createElement)(n.PanelBody,{title:(0,i.__)("Settings","content-vote"),initialOpen:!0},(0,t.createElement)(n.RangeControl,{label:(0,i.__)("Number of options","content-vote"),value:v,min:2,max:6,onChange:t=>(t=>{if(m)return;const e=s(t);w(e);const o=a(u,e,(0,i.__)("Option","content-vote"));l({options:o})})(t),disabled:m}),(0,t.createElement)(n.Button,{variant:"primary",onClick:()=>{if(m)return;g(!0),b("");const t=window?.wp?.data?.select("core/editor")?.getCurrentPostId?.()||window?.contentVotePostId||0,e=window?.wpApiSettings?.nonce||"";fetch(window.location.origin+"/wp-json/content-vote/v1/suggest?postId="+t,{headers:e?{"X-WP-Nonce":e}:{}}).then(t=>t.json()).then(t=>{t.error?b(t.message||"Error"):(t.question&&l({question:t.question}),Array.isArray(t.options)&&(l({options:a(t.options,t.options.length,(0,i.__)("Option","content-vote"))}),w(s(t.options.length))))}).catch(()=>{b("Network error")}).finally(()=>g(!1))},disabled:m||h,style:{marginTop:"0.5rem"}},h?(0,i.__)("Suggesting…","content-vote"):(0,i.__)("Generate Suggestions","content-vote")),m&&(0,t.createElement)(n.Notice,{status:"info",isDismissible:!1},(0,i.__)("Options locked after votes","content-vote")),f&&(0,t.createElement)(n.Notice,{status:"error",isDismissible:!1},f))),(0,t.createElement)("div",{..._},(0,t.createElement)(r.RichText,{tagName:"h4",value:p,placeholder:(0,i.__)("Enter question…","content-vote"),onChange:t=>!m&&l({question:t})}),(0,t.createElement)("ul",{className:"content-vote-options"},u.slice(0,v).map((e,o)=>(0,t.createElement)("li",{key:o,className:"content-vote-option-item"},(0,t.createElement)(r.RichText,{tagName:"span",value:e,placeholder:(0,i.__)("Option","content-vote")+" "+(o+1),onChange:t=>((t,e)=>{if(m)return;const o=[...u];o[e]=t,l({options:o})})(t,o),allowedFormats:[],className:"content-vote-option"}))))))},save:()=>null})}},o={};function n(t){var r=o[t];if(void 0!==r)return r.exports;var i=o[t]={exports:{}};return e[t](i,i.exports,n),i.exports}n.m=e,t=[],n.O=(e,o,r,i)=>{if(!o){var s=1/0;for(p=0;p<t.length;p++){for(var[o,r,i]=t[p],a=!0,c=0;c<o.length;c++)(!1&i||s>=i)&&Object.keys(n.O).every(t=>n.O[t](o[c]))?o.splice(c--,1):(a=!1,i<s&&(s=i));if(a){t.splice(p--,1);var l=r();void 0!==l&&(e=l)}}return e}i=i||0;for(var p=t.length;p>0&&t[p-1][2]>i;p--)t[p]=t[p-1];t[p]=[o,r,i]},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t={88:0,136:0};n.O.j=e=>0===t[e];var e=(e,o)=>{var r,i,[s,a,c]=o,l=0;if(s.some(e=>0!==t[e])){for(r in a)n.o(a,r)&&(n.m[r]=a[r]);if(c)var p=c(n)}for(e&&e(o);l<s.length;l++)i=s[l],n.o(t,i)&&t[i]&&t[i][0](),t[i]=0;return n.O(p)},o=globalThis.webpackChunkcontent_vote=globalThis.webpackChunkcontent_vote||[];o.forEach(e.bind(null,0)),o.push=e.bind(null,o.push.bind(o))})();var r=n.O(void 0,[136],()=>n(113));r=n.O(r)})();