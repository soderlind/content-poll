(()=>{"use strict";var t,e={113:()=>{const t=window.React,e=window.wp.blocks,o=window.wp.element,n=window.wp.components,l=window.wp.blockEditor,r=window.wp.i18n,i=t=>Math.min(6,Math.max(2,t)),s=(t,e,o="Option")=>{const n=i(e);let l=[...t];if(l.length<n)for(let t=l.length;t<n;t++)l.push(o);else l.length>n&&(l=l.slice(0,n));return l};(0,e.registerBlockType)("content-poll/vote-block",{edit:function(e){const{attributes:a,setAttributes:c}=e,{question:p,options:u,blockId:d}=a,[w,m]=(0,o.useState)(u.length),[x,h]=(0,o.useState)(!1),[g,f]=(0,o.useState)(!1),[v,b]=(0,o.useState)(""),_=(0,l.useBlockProps)({className:"content-poll-editor"});return d||c({blockId:window?.crypto&&"function"==typeof window.crypto.randomUUID?window.crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})}),(0,o.useEffect)(()=>{d&&fetch(window.location.origin+"/wp-json/content-poll/v1/block/"+d+"/results").then(t=>t.json()).then(t=>{t&&t.totalVotes&&t.totalVotes>0&&h(!0)}).catch(()=>{})},[d]),(0,t.createElement)(t.Fragment,null,(0,t.createElement)(l.InspectorControls,null,(0,t.createElement)(n.PanelBody,{title:(0,r.__)("Settings","content-poll"),initialOpen:!0},(0,t.createElement)(n.RangeControl,{label:(0,r.__)("Number of options","content-poll"),value:w,min:2,max:6,onChange:t=>(t=>{if(x)return;const e=i(t);m(e);const o=s(u,e,(0,r.__)("Option","content-poll"));c({options:o})})(t),disabled:x}),(0,t.createElement)(n.Button,{variant:"primary",onClick:()=>{if(x)return;f(!0),b("");const t=window?.wp?.data?.select("core/editor")?.getCurrentPostId?.()||window?.contentVotePostId||0,e=window?.wpApiSettings?.nonce||"";fetch(window.location.origin+"/wp-json/content-poll/v1/suggest?postId="+t,{headers:e?{"X-WP-Nonce":e}:{}}).then(t=>t.json()).then(t=>{t.error?b(t.message||"Error"):(t.question&&c({question:t.question}),Array.isArray(t.options)&&(c({options:s(t.options,t.options.length,(0,r.__)("Option","content-poll"))}),m(i(t.options.length))))}).catch(()=>{b("Network error")}).finally(()=>f(!1))},disabled:x||g,style:{marginTop:"0.5rem"}},g?(0,r.__)("Suggesting…","content-poll"):(0,r.__)("Generate Suggestions","content-poll")),x&&(0,t.createElement)(n.Notice,{status:"info",isDismissible:!1},(0,r.__)("Options locked after votes","content-poll")),v&&(0,t.createElement)(n.Notice,{status:"error",isDismissible:!1},v))),(0,t.createElement)("div",{..._},(0,t.createElement)(l.RichText,{tagName:"h4",value:p,placeholder:(0,r.__)("Enter question…","content-poll"),onChange:t=>!x&&c({question:t})}),(0,t.createElement)("ul",{className:"content-poll-options"},u.slice(0,w).map((e,o)=>(0,t.createElement)("li",{key:o,className:"content-poll-option-item"},(0,t.createElement)(l.RichText,{tagName:"span",value:e,placeholder:(0,r.__)("Option","content-poll")+" "+(o+1),onChange:t=>((t,e)=>{if(x)return;const o=[...u];o[e]=t,c({options:o})})(t,o),allowedFormats:[],className:"content-poll-option"}))))))},save:()=>null})}},o={};function n(t){var l=o[t];if(void 0!==l)return l.exports;var r=o[t]={exports:{}};return e[t](r,r.exports,n),r.exports}n.m=e,t=[],n.O=(e,o,l,r)=>{if(!o){var i=1/0;for(p=0;p<t.length;p++){for(var[o,l,r]=t[p],s=!0,a=0;a<o.length;a++)(!1&r||i>=r)&&Object.keys(n.O).every(t=>n.O[t](o[a]))?o.splice(a--,1):(s=!1,r<i&&(i=r));if(s){t.splice(p--,1);var c=l();void 0!==c&&(e=c)}}return e}r=r||0;for(var p=t.length;p>0&&t[p-1][2]>r;p--)t[p]=t[p-1];t[p]=[o,l,r]},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t={88:0,136:0};n.O.j=e=>0===t[e];var e=(e,o)=>{var l,r,[i,s,a]=o,c=0;if(i.some(e=>0!==t[e])){for(l in s)n.o(s,l)&&(n.m[l]=s[l]);if(a)var p=a(n)}for(e&&e(o);c<i.length;c++)r=i[c],n.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return n.O(p)},o=globalThis.webpackChunkcontent_poll=globalThis.webpackChunkcontent_poll||[];o.forEach(e.bind(null,0)),o.push=e.bind(null,o.push.bind(o))})();var l=n.O(void 0,[136],()=>n(113));l=n.O(l)})();