(()=>{"use strict";var t,o={922:()=>{const t=window.wp.blocks,o=window.wp.element,e=window.wp.components,n=window.wp.blockEditor,s=window.wp.i18n,l=t=>Math.min(6,Math.max(2,t)),i=(t,o,e="Option")=>{const n=l(o);let s=[...t];if(s.length<n)for(let t=s.length;t<n;t++)s.push(e);else s.length>n&&(s=s.slice(0,n));return s},r=window.ReactJSXRuntime;(0,t.registerBlockType)("content-poll/vote-block",{edit:function(t){const{attributes:a,setAttributes:c}=t,{question:p,options:d,pollId:x}=a,[u,h]=(0,o.useState)(d.length),[w,g]=(0,o.useState)(!1),[m,f]=(0,o.useState)(!1),[v,b]=(0,o.useState)(""),_=(0,n.useBlockProps)({className:"content-poll-editor"});return x||c({pollId:window?.crypto&&"function"==typeof window.crypto.randomUUID?window.crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const o=16*Math.random()|0;return("x"===t?o:3&o|8).toString(16)})}),(0,o.useEffect)(()=>{x&&fetch(window.location.origin+"/wp-json/content-poll/v1/block/"+x+"/results").then(t=>t.json()).then(t=>{t&&t.totalVotes&&t.totalVotes>0&&g(!0)}).catch(()=>{})},[x]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.InspectorControls,{children:(0,r.jsxs)(e.PanelBody,{title:(0,s.__)("Settings","content-poll"),initialOpen:!0,children:[(0,r.jsx)(e.RangeControl,{label:(0,s.__)("Number of options","content-poll"),value:u,min:2,max:6,onChange:t=>(t=>{if(w)return;const o=l(t);h(o);const e=i(d,o,(0,s.__)("Option","content-poll"));c({options:e})})(t),disabled:w}),(0,r.jsx)(e.Button,{variant:"primary",onClick:()=>{if(w)return;f(!0),b("");const t=window?.wp?.data?.select("core/editor")?.getCurrentPostId?.()||window?.contentVotePostId||0,o=window?.wpApiSettings?.nonce||"";fetch(window.location.origin+"/wp-json/content-poll/v1/suggest?postId="+t,{headers:o?{"X-WP-Nonce":o}:{}}).then(t=>t.json()).then(t=>{if(t.error)b(t.message||"Error");else if(t.question&&c({question:t.question}),Array.isArray(t.options)){const o=[...t.options].sort(()=>Math.random()-.5);c({options:i(o,o.length,(0,s.__)("Option","content-poll"))}),h(l(o.length))}}).catch(()=>{b("Network error")}).finally(()=>f(!1))},disabled:w||m,style:{marginTop:"0.5rem"},children:m?(0,s.__)("Suggesting…","content-poll"):(0,s.__)("Generate Suggestions","content-poll")}),w&&(0,r.jsx)(e.Notice,{status:"info",isDismissible:!1,children:(0,s.__)("Options locked after votes","content-poll")}),v&&(0,r.jsx)(e.Notice,{status:"error",isDismissible:!1,children:v})]})}),(0,r.jsxs)("div",{..._,children:[(0,r.jsx)(n.RichText,{tagName:"h4",value:p,placeholder:(0,s.__)("Enter question…","content-poll"),onChange:t=>!w&&c({question:t})}),(0,r.jsx)("ul",{className:"content-poll-options",children:d.slice(0,u).map((t,o)=>(0,r.jsx)("li",{className:"content-poll-option-item",children:(0,r.jsx)(n.RichText,{tagName:"span",value:t,placeholder:(0,s.__)("Option","content-poll")+" "+(o+1),onChange:t=>((t,o)=>{if(w)return;const e=[...d];e[o]=t,c({options:e})})(t,o),allowedFormats:[],className:"content-poll-option"})},o))})]})]})},save:()=>null})}},e={};function n(t){var s=e[t];if(void 0!==s)return s.exports;var l=e[t]={exports:{}};return o[t](l,l.exports,n),l.exports}n.m=o,t=[],n.O=(o,e,s,l)=>{if(!e){var i=1/0;for(p=0;p<t.length;p++){for(var[e,s,l]=t[p],r=!0,a=0;a<e.length;a++)(!1&l||i>=l)&&Object.keys(n.O).every(t=>n.O[t](e[a]))?e.splice(a--,1):(r=!1,l<i&&(i=l));if(r){t.splice(p--,1);var c=s();void 0!==c&&(o=c)}}return o}l=l||0;for(var p=t.length;p>0&&t[p-1][2]>l;p--)t[p]=t[p-1];t[p]=[e,s,l]},n.o=(t,o)=>Object.prototype.hasOwnProperty.call(t,o),(()=>{var t={88:0,136:0};n.O.j=o=>0===t[o];var o=(o,e)=>{var s,l,[i,r,a]=e,c=0;if(i.some(o=>0!==t[o])){for(s in r)n.o(r,s)&&(n.m[s]=r[s]);if(a)var p=a(n)}for(o&&o(e);c<i.length;c++)l=i[c],n.o(t,l)&&t[l]&&t[l][0](),t[l]=0;return n.O(p)},e=globalThis.webpackChunkcontent_poll=globalThis.webpackChunkcontent_poll||[];e.forEach(o.bind(null,0)),e.push=o.bind(null,e.push.bind(e))})();var s=n.O(void 0,[136],()=>n(922));s=n.O(s)})();