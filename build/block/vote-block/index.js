(()=>{"use strict";var t,o={922:()=>{const t=window.wp.blocks,o=window.wp.element,n=window.wp.components,e=window.wp.blockEditor,s=window.wp.i18n,i=t=>Math.min(6,Math.max(2,t)),l=(t,o,n="Option")=>{const e=i(o);let s=[...t];if(s.length<e)for(let t=s.length;t<e;t++)s.push(n);else s.length>e&&(s=s.slice(0,e));return s},r=window.ReactJSXRuntime;(0,t.registerBlockType)("content-poll/vote-block",{edit:function(t){const{attributes:c,setAttributes:a}=t,{question:p,options:d,pollId:x}=c,[u,h]=(0,o.useState)(d.length),[w,g]=(0,o.useState)(!1),[m,f]=(0,o.useState)(!1),[v,b]=(0,o.useState)(""),_=(0,e.useBlockProps)({className:"content-poll-editor"});return x||a({pollId:window?.crypto&&"function"==typeof window.crypto.randomUUID?window.crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const o=16*Math.random()|0;return("x"===t?o:3&o|8).toString(16)})}),(0,o.useEffect)(()=>{x&&fetch(window.location.origin+"/wp-json/content-poll/v1/block/"+x+"/results").then(t=>t.json()).then(t=>{t&&t.totalVotes&&t.totalVotes>0&&g(!0)}).catch(()=>{})},[x]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.InspectorControls,{children:(0,r.jsxs)(n.PanelBody,{title:(0,s.__)("Settings","content-poll"),initialOpen:!0,children:[(0,r.jsx)(n.RangeControl,{label:(0,s.__)("Number of options","content-poll"),value:u,min:2,max:6,onChange:t=>(t=>{if(w)return;const o=i(t);h(o);const n=l(d,o,(0,s.__)("Option","content-poll"));a({options:n})})(t),disabled:w}),(0,r.jsx)(n.Button,{variant:"primary",onClick:()=>{if(w)return;f(!0),b("");const t=window?.wp?.data?.select("core/editor")?.getCurrentPostId?.()||window?.contentVotePostId||0,o=window?.wpApiSettings?.nonce||"";fetch(window.location.origin+"/wp-json/content-poll/v1/suggest?postId="+t,{headers:o?{"X-WP-Nonce":o}:{}}).then(t=>t.json()).then(t=>{t.error?b(t.message||"Error"):(t.question&&a({question:t.question}),Array.isArray(t.options)&&(a({options:l(t.options,t.options.length,(0,s.__)("Option","content-poll"))}),h(i(t.options.length))))}).catch(()=>{b("Network error")}).finally(()=>f(!1))},disabled:w||m,style:{marginTop:"0.5rem"},children:m?(0,s.__)("Suggesting…","content-poll"):(0,s.__)("Generate Suggestions","content-poll")}),w&&(0,r.jsx)(n.Notice,{status:"info",isDismissible:!1,children:(0,s.__)("Options locked after votes","content-poll")}),v&&(0,r.jsx)(n.Notice,{status:"error",isDismissible:!1,children:v})]})}),(0,r.jsxs)("div",{..._,children:[(0,r.jsx)(e.RichText,{tagName:"h4",value:p,placeholder:(0,s.__)("Enter question…","content-poll"),onChange:t=>!w&&a({question:t})}),(0,r.jsx)("ul",{className:"content-poll-options",children:d.slice(0,u).map((t,o)=>(0,r.jsx)("li",{className:"content-poll-option-item",children:(0,r.jsx)(e.RichText,{tagName:"span",value:t,placeholder:(0,s.__)("Option","content-poll")+" "+(o+1),onChange:t=>((t,o)=>{if(w)return;const n=[...d];n[o]=t,a({options:n})})(t,o),allowedFormats:[],className:"content-poll-option"})},o))})]})]})},save:()=>null})}},n={};function e(t){var s=n[t];if(void 0!==s)return s.exports;var i=n[t]={exports:{}};return o[t](i,i.exports,e),i.exports}e.m=o,t=[],e.O=(o,n,s,i)=>{if(!n){var l=1/0;for(p=0;p<t.length;p++){for(var[n,s,i]=t[p],r=!0,c=0;c<n.length;c++)(!1&i||l>=i)&&Object.keys(e.O).every(t=>e.O[t](n[c]))?n.splice(c--,1):(r=!1,i<l&&(l=i));if(r){t.splice(p--,1);var a=s();void 0!==a&&(o=a)}}return o}i=i||0;for(var p=t.length;p>0&&t[p-1][2]>i;p--)t[p]=t[p-1];t[p]=[n,s,i]},e.o=(t,o)=>Object.prototype.hasOwnProperty.call(t,o),(()=>{var t={88:0,136:0};e.O.j=o=>0===t[o];var o=(o,n)=>{var s,i,[l,r,c]=n,a=0;if(l.some(o=>0!==t[o])){for(s in r)e.o(r,s)&&(e.m[s]=r[s]);if(c)var p=c(e)}for(o&&o(n);a<l.length;a++)i=l[a],e.o(t,i)&&t[i]&&t[i][0](),t[i]=0;return e.O(p)},n=globalThis.webpackChunkcontent_poll=globalThis.webpackChunkcontent_poll||[];n.forEach(o.bind(null,0)),n.push=o.bind(null,n.push.bind(n))})();var s=e.O(void 0,[136],()=>e(922));s=e.O(s)})();